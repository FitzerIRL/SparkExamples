/*
   Copyright 2005-2017 John Robinson

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   pxSnowflakes - written by Hugh Fitzpatrick
*/

px.import({  scene: 'px:scene.1.js',
              keys: 'px:tools.keys.js'
}).then( function importsAreReady(imports)
{
  module.exports.wantsClearscreen = function()
  {
    return false; // skip clearscreen by framework... using opaque bg.
  };

  var scene = imports.scene;
  var root  = scene.root;
  var base  = px.getPackageBaseFilePath();

  var flakes = [];

  const flake1_svg = "data:image/svg," + '<svg width="400" height="400" xmlns="http://www.w3.org/2000/svg"><path fill="#55F" fill-opacity=".8" d="m219.04236 135c-3.33916 4.54072-7.85255 10.20565-7.85252 22.76439 0 9.10208 1.86874 16.90668 4.52115 20.54348v5.07638c-1.57673-2.36991-4.79231-5.20661-8.96299-7.61457-6.75311-3.89891-11.02818-3.29386-14.67391-2.85546 1.40499 3.20522 3.00311 7.3643 9.75617 11.26322 5.85644 3.38119 11.59321 4.76502 13.88073 3.56933v10.94594c-1.57673-2.36991-4.79231-5.20661-8.96299-7.61457-6.75311-3.89889-11.02818-3.29389-14.67391-2.85546 1.40499 3.20527 3.00311 7.36425 9.75617 11.26322 5.85832 3.38231 11.59468 4.7671 13.88073 3.56933v7.69389c-1.47936 1.52847-2.60167 3.12626-3.49001 4.7591-2.17046 3.37364-3.37026 6.90842-3.09342 10.94595-.23407 3.5808.65774 6.86408 2.37955 9.9148.95758 2.06769 2.29818 4.05842 4.20388 5.94889v2.45887c-2.22074.28923-4.34262.84116-6.34548 1.66569l-5.55229-9.51822c-.41743-5.93652-4.41249-16.60382-10.94594-27.92009-9.1119-15.78229-16.81432-20.4952-23.31963-24.66804.40269 7.37583.64422 16.65893 9.75617 32.44125 6.50762 11.27149 13.709 20.1179 18.63984 23.47826l5.55229 9.59753c-1.70267 1.31877-3.20142 2.89859-4.52115 4.60047l-2.30024-1.26909c-.68503-2.54665-1.72087-4.66736-3.0141-6.50412-1.78123-3.01643-4.15855-5.47165-7.37662-7.05934-3.35817-2.25848-7.01845-2.96895-11.02526-2.77615-1.82509-.04622-3.76807.13897-5.79025.63455l-6.66275-3.80728c2.14259-1.46208 3.72797-7.1148 3.72797-13.80141 0-7.79783-2.7651-11.29929-4.83842-14.11869-2.20257 2.93806-4.83843 6.32086-4.83843 14.11869.0001 4.7289.75732 8.93671 1.98296 11.50117l-9.28026-5.39365c2.14208-1.46314 3.72797-7.03653 3.72797-13.72209 0-7.79781-2.76511-11.37864-4.83843-14.19801-2.20256 2.93806-4.83842 6.40018-4.83842 14.19801.00005 4.7289.75729 8.85737 1.98296 11.42185l-4.2832-2.45887c-1.83569-4.11286-7.67924-9.57664-15.54641-14.11868-10.87612-6.27938-17.76538-5.30647-23.6369-4.60047 2.26282 5.16214 4.90817 11.88457 15.78437 18.16392 7.88268 4.55105 15.59183 6.82415 20.06757 6.34548l4.36251 2.53819c-2.84074.18051-6.85456 1.55799-11.02526 3.96592-6.75308 3.89889-8.39227 7.88672-9.83549 11.26322 3.47826.38586 7.84151 1.12272 14.5946-2.77615 5.85646-3.38122 9.96516-7.65317 10.07344-10.23208l9.43889 5.47298c-2.84074.18051-6.85458 1.55799-11.02526 3.96592-6.75303 3.89891-8.39232 7.88672-9.83549 11.26322 3.47829.38585 7.92078 1.04337 14.67392-2.85546 5.85834-3.38235 9.8884-7.65341 9.99412-10.23208l6.66275 3.8866c.58396 2.04537 1.40963 3.80792 2.37955 5.39365 1.83643 3.56649 4.29683 6.39081 7.93185 8.1698 2.984 1.99312 6.25326 2.82123 9.75617 2.85547 2.26939.20453 4.70725.07061 7.29729-.63455l2.1416 1.2691c-.81397 1.97661-1.3726 4.07679-1.66568 6.26615h-11.10459c-5.35416-2.604-16.60674-4.4418-29.6651-4.44183-18.22385 0-26.13003 4.30525-32.99647 7.85253 6.58896 3.33919 14.7726 7.7732 32.99647 7.7732 13.05838 0 24.31094-1.75853 29.6651-4.36251h11.10459c.2941 2.18025.85483 4.29716 1.66568 6.26616l-2.22091 1.26909c-2.54799-.68011-4.98069-.91547-7.21798-.71386-3.50296.03431-6.77215.94169-9.75617 2.93478-3.63502 1.77902-6.09542 4.60339-7.93185 8.1698-.95253 1.55754-1.71833 3.31529-2.30023 5.31434l-6.66275 3.8866c-.19488-2.58654-4.28266-6.80945-10.07344-10.15276-6.75309-3.89887-11.19561-3.24132-14.67392-2.85547 1.44314 3.37648 3.08238 7.36431 9.83549 11.26323 4.09545 2.36445 8.11223 3.82444 10.94595 4.04524l-9.28026 5.31433c-.19608-2.58669-4.28355-6.73067-10.07345-10.07344-6.75308-3.89889-11.1956-3.32064-14.67391-2.93478 1.44314 3.37645 3.08235 7.44362 9.83549 11.34254 4.09539 2.36445 8.11221 3.74515 10.94595 3.96592l-4.2832 2.45887c-4.47968-.46665-12.12113 1.88265-19.98825 6.4248-10.87615 6.27935-13.53934 12.72602-15.86369 18.16392 5.60196.62143 12.76073 1.67891 23.6369-4.60047 7.88268-4.55105 13.72308-10.08256 15.54641-14.198l4.36252-2.53819c-1.26402 2.55042-2.06226 6.7646-2.06228 11.58049.00002 7.79783 2.63591 11.18058 4.83842 14.11868 2.07327-2.81939 4.8384-6.24161 4.83843-14.03936.00002-6.76245-1.62805-12.4182-3.80729-13.80141l9.4389-5.47297c-1.26402 2.55045-2.06228 6.76463-2.06228 11.58049.00008 7.7978 2.63586 11.18063 4.83843 14.11868 2.07329-2.81937 4.91766-6.32088 4.91774-14.11868.00002-6.76456-1.70627-12.42053-3.88661-13.80141l6.66275-3.80729c2.06332.51693 4.01131.68166 5.86957.63455 4.00689.19285 7.66709-.51761 11.02526-2.77614 3.21807-1.58767 5.59552-4.04286 7.37662-7.05935 1.31179-1.86316 2.4091-3.9878 3.09342-6.58343l2.1416-1.2691c1.33174 1.73257 2.87376 3.2615 4.60047 4.60047l-5.63161 9.67686c-4.92853 3.39721-12.08461 12.1823-18.56052 23.39894-9.1119 15.78232-9.39506 24.80043-9.75617 32.52056 6.18628-4.03663 14.20767-8.88572 23.31963-24.66803 6.53345-11.31632 10.52851-21.9836 10.94594-27.9201l5.55229-9.59753c2.00357.82509 4.12383 1.45565 6.34548 1.74501v2.53819c-1.86296 1.86653-3.25982 3.83119-4.20388 5.86956-1.72173 3.05073-2.6136 6.33403-2.37955 9.91481-.27684 4.03752.92304 7.57236 3.09342 10.94594.87255 1.60371 2.04971 3.17632 3.49001 4.67979v7.69389c-2.33747-1.12457-8.01063.30535-13.80141 3.64865-6.75309 3.89892-8.4305 8.05799-9.83549 11.26322 3.64571.43842 7.9208 1.04345 14.67391-2.85546 4.09532-2.36448 7.35492-5.11227 8.96299-7.45594v10.70799c-2.33818-1.12355-8.01155.30583-13.80141 3.64865-6.75309 3.89889-8.4305 8.05797-9.83549 11.26322 3.64568.43835 7.9208 1.04348 14.67391-2.85546 4.09537-2.36445 7.35492-5.11222 8.96299-7.45594v4.91775c-2.64398 3.64618-4.44189 11.45927-4.44183 20.54348-.00003 12.55871 4.22603 18.03249 7.7732 22.76439 3.33915-4.5407 7.85256-10.20566 7.85253-22.76439 0-9.10208-1.86874-16.90671-4.52115-20.54348v-5.07638c1.57672 2.36985 4.7923 5.20661 8.96298 7.61457 6.75311 3.89889 11.02819 3.29383 14.67392 2.85546-1.40499-3.20528-3.00311-7.3643-9.75617-11.26322-5.85645-3.38125-11.59321-4.76499-13.88073-3.56933v-10.94594c1.57672 2.3699 4.7923 5.20664 8.96298 7.61457 6.75311 3.89891 11.02819 3.29391 14.67392 2.85546-1.40499-3.20523-3.00311-7.36425-9.75617-11.26322-5.85832-3.38232-11.59468-4.76713-13.88073-3.56933v-7.69389c1.47936-1.52847 2.60169-3.12624 3.49001-4.75911 2.17046-3.37361 3.37026-6.90839 3.09342-10.94594.23407-3.58075-.65775-6.86411-2.37955-9.91481-.95761-2.06768-2.29818-4.05844-4.20388-5.94888v-2.45887c2.21366-.2903 4.34855-.92266 6.34547-1.74501l5.47298 9.51821c.38481 5.91955 4.46125 16.6302 11.02526 27.99942 9.11193 15.78231 16.8145 20.49522 23.31963 24.66803-.40269-7.3758-.64422-16.73824-9.75617-32.52056-6.54089-11.32914-13.78629-20.15737-18.71916-23.47826l-5.47297-9.59754c1.72671-1.33897 3.26873-2.8679 4.60047-4.60047l2.22092 1.2691c.68503 2.54664 1.72086 4.74667 3.0141 6.58343 1.78122 3.01644 4.15854 5.47166 7.37661 7.05935 3.35816 2.25853 7.01845 2.96897 11.02527 2.77614 1.82506.0462 3.76807-.21826 5.79024-.71386l6.66275 3.8866c-2.14261 1.46202-3.72796 7.03548-3.72796 13.72209 0 7.7978 2.7651 11.37863 4.83842 14.198 2.20254-2.93805 4.83843-6.32085 4.83843-14.11868.00002-4.7289-.75732-8.93669-1.98296-11.50118l9.28025 5.31434c-2.1421 1.46317-3.72801 7.11584-3.72796 13.80141-.00003 7.79778 2.7651 11.29931 4.83842 14.11868 2.20254-2.93808 4.83845-6.32085 4.83843-14.11868-.00005-4.72893-.7573-8.93666-1.98296-11.50117l4.28319 2.45887c1.8357 4.11288 7.67925 9.57662 15.54642 14.11868 10.87612 6.27938 17.76538 5.38576 23.6369 4.67979-2.26282-5.16215-4.90818-11.88459-15.78437-18.16392-7.88271-4.55108-15.59183-6.90345-20.06757-6.4248l-4.36252-2.53819c2.84072-.18054 6.85459-1.47867 11.02527-3.8866 6.75306-3.89892 8.39227-7.96606 9.83549-11.34254-3.47826-.38586-7.92083-1.0434-14.67392 2.85546-5.85647 3.38118-9.88584 7.6532-9.99412 10.23208l-9.51822-5.47297c2.84075-.18052 6.93391-1.55797 11.10459-3.96592 6.75318-3.89889 8.39232-7.8867 9.83548-11.26323-3.47831-.38585-7.92077-1.12269-14.67391 2.77615-5.85837 3.38232-9.88841 7.65341-9.99412 10.23208l-6.66275-3.80728c-.58396-2.0454-1.40961-3.80792-2.37956-5.39366-1.83645-3.56651-4.2968-6.39078-7.93184-8.1698-2.98402-1.99309-6.25326-2.90057-9.75617-2.93478-2.2694-.20453-4.70728.0087-7.2973.71386l-2.1416-1.26909c.81085-1.969 1.37162-4.08591 1.66569-6.26616h11.10458c5.36574 2.59647 16.63 4.36249 29.6651 4.36251 18.22386 0 26.13007-4.22593 32.99648-7.7732-6.58897-3.33917-14.7726-7.8525-32.99648-7.85253-13.0351 0-24.29936 1.84537-29.6651 4.44183h-11.10458c-.29641-2.21424-.83689-4.34926-1.66569-6.34547l2.22092-1.2691c2.54799.68008 4.98067.91545 7.21798.71387 3.50296-.03432 6.77215-.86238 9.75617-2.85547 3.63499-1.77899 6.09544-4.60338 7.93184-8.1698.95251-1.55748 1.71836-3.3946 2.30024-5.39365l6.66275-3.80729c.19486 2.58652 4.28266 6.73014 10.07344 10.07345 6.75309 3.89883 11.1956 3.32066 14.67391 2.93478-1.44316-3.3765-3.08237-7.36431-9.83548-11.26322-4.0953-2.3644-8.11224-3.82442-10.94595-4.04524l9.28026-5.39366c.19607 2.5867 4.28353 6.81002 10.07344 10.15277 6.75306 3.89891 11.19561 3.24132 14.67392 2.85546-1.44314-3.37645-3.08236-7.36433-9.83549-11.26322-4.09542-2.36448-8.11216-3.82444-10.94595-4.04524l4.2832-2.45887c4.47968.46662 12.12113-1.88265 19.98825-6.4248 10.87614-6.2793 13.53931-12.64673 15.86369-18.0846-5.60197-.62143-12.76073-1.67894-23.6369 4.60047-7.88271 4.55102-13.72308 10.00326-15.54642 14.11868l-4.36251 2.53819c1.26399-2.55042 2.06228-6.68529 2.06228-11.50117-.00005-7.79778-2.63591-11.25992-4.83843-14.19801-2.07327 2.81937-4.91772 6.32091-4.91774 14.11869-.00003 6.76242 1.70736 12.4182 3.8866 13.80141l-9.51821 5.47297c1.26402-2.55047 2.1416-6.76461 2.1416-11.58049.00007-7.79783-2.63586-11.1806-4.83843-14.11869-2.07332 2.8194-4.91767 6.24157-4.91774 14.03937-.00005 6.76455 1.70625 12.42051 3.8866 13.80141l-6.66275 3.8866c-2.06332-.51698-4.0113-.68168-5.86956-.63455-4.00692-.1929-7.66706.51762-11.02527 2.77615-3.21809 1.58769-5.59551 4.04283-7.37661 7.05934-1.31179 1.86316-2.4091 3.98783-3.09342 6.58343l-2.1416 1.2691c-1.33476-1.7365-2.86904-3.33876-4.60047-4.67979l5.47297-9.51821c4.93336-3.31092 12.16999-12.21403 18.71916-23.55758 9.1119-15.78232 9.39506-24.72116 9.75617-32.44125-6.18631 4.03664-14.2077 8.8857-23.31963 24.66804-6.56401 11.36924-10.64045 22.07987-11.02526 27.99941l-5.47298 9.4389c-1.99618-.82179-4.13273-1.3755-6.34547-1.66569v-2.53819c1.86295-1.86651 3.25982-3.83122 4.20388-5.86957 1.72173-3.05072 2.6136-6.33402 2.37955-9.9148.27684-4.0375-.92304-7.57234-3.09342-10.94595-.87255-1.60365-2.04974-3.17634-3.49001-4.67979v-7.69389c2.33747 1.12455 8.01063-.30534 13.80141-3.64864 6.75308-3.89894 8.4305-8.05797 9.83549-11.26322-3.64571-.4384-7.92081-1.04345-14.67392 2.85546-4.09534 2.3645-7.35491 5.11225-8.96298 7.45593v-10.70799c2.33815 1.12356 8.01152-.30585 13.80141-3.64864 6.75308-3.89892 8.4305-8.058 9.83549-11.26322-3.64571-.4384-7.92081-1.04345-14.67392 2.85546-4.09534 2.36448-7.35491 5.11224-8.96298 7.45593v-4.91774c2.64398-3.64621 4.44188-11.4593 4.44183-20.54348 0-12.55874-4.22603-18.0325-7.77321-22.76439z"/></svg>';
  const flake2_svg = "data:image/svg," + '<svg width="400" height="400" xmlns="http://www.w3.org/2000/svg"><path fill="#eee" fill-opacity=".8" d="m191.42856 93.571429c-3.33914 4.5407-7.85255 10.205661-7.85252 22.764391.00002 9.10208 1.86874 16.90669 4.52115 20.54348v5.07638c-1.5767-2.36991-4.79231-5.20661-8.96299-7.61457-6.75308-3.89891-11.02818-3.29386-14.67391-2.85546 1.40502 3.20522 3.00311 7.3643 9.75617 11.26322 5.85647 3.3812 11.59321 4.76502 13.88073 3.56933v10.94594c-1.5767-2.3699-4.79231-5.20661-8.96299-7.61457-6.75308-3.89889-11.02818-3.29388-14.67391-2.85546 1.40502 3.20528 3.00311 7.36425 9.75617 11.26322 5.85835 3.38232 11.59468 4.7671 13.88073 3.56933v7.69389c-1.47933 1.52847-2.60167 3.12626-3.49001 4.75911-1.79326 2.78736-2.91075 5.68361-3.09342 8.88366-2.72178.58853-5.32962 1.33902-7.85253 2.37956-1.88331-5.24322-4.71629-11.37353-8.40775-17.76734-9.11188-15.78229-16.81432-20.4952-23.31963-24.66803.40271 7.37582.64422 16.65893 9.75617 32.44124 3.69832 6.40566 7.58155 11.98292 11.1839 16.26028-2.16048 1.67315-4.19253 3.53276-6.0282 5.55229-2.85696-1.42994-5.89787-1.90394-9.20094-1.745-1.82506-.04622-3.76807.13896-5.79025.63455l-6.66275-3.80729c2.14262-1.46207 3.72797-7.1148 3.72797-13.80141.00003-7.79783-2.7651-11.29929-4.83842-14.11868-2.20254 2.93805-4.83843 6.32085-4.83843 14.11868.00013 4.7289.75732 8.93671 1.98296 11.50118l-9.28026-5.39366c2.14211-1.46314 3.72797-7.03652 3.72797-13.72209.00002-7.7978-2.76511-11.37863-4.83843-14.198-2.20254 2.93805-4.83842 6.40017-4.83842 14.198.00007 4.7289.75729 8.85737 1.98296 11.42186l-4.2832-2.45888c-1.83567-4.11285-7.67924-9.57664-15.546406-14.11868-10.8761-6.27938-17.76538-5.30647-23.6369-4.60047 2.26285 5.16215 4.90817 11.88457 15.78437 18.16392 7.88271 4.55106 15.591826 6.82416 20.067566 6.34548l4.36251 2.53819c-2.84071.18052-6.85456 1.55799-11.02526 3.96592-6.753056 3.89889-8.392266 7.88672-9.835486 11.26322 3.47829.38586 7.841506 1.12272 14.594596-2.77614 5.85649-3.38123 9.96516-7.65318 10.07344-10.23208l9.43889 5.47297c-2.84071.18052-6.85458 1.55799-11.02526 3.96592-6.75301 3.89892-8.39232 7.88672-9.83549 11.26322 3.47831.38586 7.92078 1.04338 14.67392-2.85546 5.85837-3.38234 9.8884-7.65341 9.99412-10.23208l6.66275 3.8866c.58399 2.04538 1.40963 3.80792 2.37955 5.39366 1.51507 2.94234 3.4339 5.3768 6.10752 7.13866-.81788 2.55857-1.37757 5.20319-1.745 7.93184-5.50087-.98877-12.25677-1.58634-19.67098-1.58637-18.22382 0-26.130026 4.30526-32.996466 7.85253 6.58899 3.33919 14.772596 7.77321 32.996466 7.77321 7.41423 0 14.17011-.54038 19.67098-1.50705.36743 2.72865.92712 5.37327 1.745 7.93184-2.67362 1.76186-4.59247 4.19637-6.10752 7.13866-.9525 1.55751-1.71833 3.31529-2.30023 5.31434l-6.66275 3.8866c-.19486-2.58657-4.28266-6.80945-10.07344-10.15276-6.75306-3.89889-11.19561-3.24132-14.67392-2.85546 1.44317 3.37645 3.08238 7.3643 9.83549 11.26322 4.09547 2.36442 8.11223 3.82444 10.94595 4.04524l-9.28026 5.31433c-.19605-2.58672-4.28355-6.73067-10.07345-10.07344-6.75305-3.89891-11.195596-3.32064-14.673906-2.93478 1.44317 3.37643 3.08235 7.44362 9.835486 11.34254 4.09542 2.36442 8.11221 3.74515 10.94595 3.96592l-4.2832 2.45887c-4.47965-.46667-12.121126 1.88265-19.988246 6.4248-10.87612 6.27933-13.53934 12.72602-15.86369 18.16392 5.60199.62145 12.76073 1.67891 23.6369-4.60047 7.882696-4.55103 13.723076-10.08256 15.546406-14.198l4.36252-2.53819c-1.26399 2.5504-2.06226 6.7646-2.06228 11.58049.00005 7.7978 2.63591 11.18058 4.83842 14.11868 2.0733-2.81937 4.8384-6.24161 4.83843-14.03936.00005-6.76248-1.62805-12.4182-3.80729-13.80141l9.4389-5.47297c-1.26399 2.55042-2.06228 6.76463-2.06228 11.58049.0001 7.79778 2.63586 11.18063 4.83843 14.11868 2.07332-2.81934 4.91766-6.32088 4.91774-14.11868.00005-6.76458-1.70627-12.42053-3.88661-13.80141l6.66275-3.80729c2.06335.51691 4.01131.68166 5.86957.63455 3.32726.16014 6.40555-.29024 9.28026-1.745 1.81529 1.9876 3.81792 3.82269 5.94888 5.47297-3.60085 4.26923-7.48502 9.85361-11.1839 16.26028-9.11187 15.78229-9.39506 24.80043-9.75617 32.52056 6.18631-4.03661 14.20767-8.88572 23.31963-24.66803 3.68342-6.3799 6.52419-12.53148 8.40775-17.76734 2.52276 1.04031 5.13095 1.79115 7.85253 2.37956.1827 3.20005 1.30021 6.09635 3.09342 8.88366.87258 1.60368 2.04971 3.17632 3.49001 4.67979v7.69389c-2.33745-1.12454-8.01063.30535-13.80141 3.64865-6.75306 3.89894-8.4305 8.05799-9.83549 11.26322 3.64573.43845 7.9208 1.04345 14.67391-2.85546 4.09535-2.36445 7.35492-5.11227 8.96299-7.45594v10.70799c-2.33816-1.12353-8.01155.30583-13.80141 3.64865-6.75306 3.89892-8.4305 8.05797-9.83549 11.26322 3.64571.43837 7.9208 1.04348 14.67391-2.85546 4.0954-2.36443 7.35492-5.11222 8.96299-7.45594v4.91775c-2.64396 3.64621-4.44189 11.45927-4.44183 20.54348 0 12.55873 4.22603 18.03249 7.7732 22.76439 3.33917-4.54067 7.85256-10.20566 7.85253-22.76439.00003-9.10206-1.86874-16.90671-4.52115-20.54348v-5.07638c1.57675 2.36988 4.7923 5.20661 8.96298 7.61457 6.75314 3.89891 11.02819 3.29383 14.67392 2.85546-1.40497-3.20525-3.00311-7.3643-9.75617-11.26322-5.85642-3.38122-11.59321-4.76499-13.88073-3.56933v-10.94594c1.57675 2.36993 4.7923 5.20664 8.96298 7.61457 6.75314 3.89894 11.02819 3.29391 14.67392 2.85546-1.40497-3.2052-3.00311-7.36425-9.75617-11.26322-5.8583-3.38229-11.59468-4.76713-13.88073-3.56933v-7.69389c1.47938-1.5285 2.60169-3.12624 3.49001-4.75911 1.77897-2.76507 2.89719-5.63465 3.09342-8.80434 2.70381-.5833 5.2653-1.42944 7.77321-2.45888 1.90379 5.24294 4.79482 11.37216 8.48707 17.76734 9.11195 15.78229 16.8145 20.49522 23.31963 24.66803-.40266-7.37577-.64422-16.73824-9.75617-32.52056-3.70381-6.4152-7.65539-11.99478-11.26322-16.26028 2.13715-1.65358 4.12897-3.48032 5.94888-5.47297 2.88648 1.47133 6.0164 1.9059 9.35958 1.745 1.82508.04617 3.76807-.21826 5.79024-.71386l6.66275 3.8866c-2.14258 1.462-3.72796 7.03548-3.72796 13.72209.00002 7.79778 2.7651 11.37863 4.83842 14.198 2.20257-2.93803 4.83843-6.32085 4.83843-14.11868.00005-4.72893-.75732-8.93669-1.98296-11.50118l9.28025 5.31434c-2.14208 1.46314-3.72801 7.11584-3.72796 13.80141 0 7.79775 2.7651 11.29931 4.83842 14.11868 2.20257-2.93805 4.83845-6.32085 4.83843-14.11868-.00003-4.72895-.7573-8.93666-1.98296-11.50117l4.28319 2.45887c1.83572 4.11286 7.67925 9.57662 15.54642 14.11868 10.87615 6.27941 17.76538 5.38576 23.6369 4.67979-2.2628-5.16212-4.90818-11.88459-15.78437-18.16392-7.88268-4.55111-15.59183-6.90345-20.06757-6.4248l-4.36252-2.53819c2.84075-.18057 6.85459-1.47867 11.02527-3.8866 6.75308-3.89894 8.39227-7.96606 9.83549-11.34254-3.47824-.38588-7.92083-1.0434-14.67392 2.85546-5.85644 3.38115-9.88584 7.6532-9.99412 10.23208l-9.51822-5.47297c2.84077-.18054 6.93391-1.55797 11.10459-3.96592 6.75321-3.89892 8.39232-7.88669 9.83548-11.26322-3.47828-.38588-7.92077-1.1227-14.67391 2.77614-5.85834 3.38229-9.88841 7.65341-9.99412 10.23208l-6.66275-3.80728c-.58394-2.04543-1.40961-3.80792-2.37956-5.39366-1.50887-2.93036-3.45077-5.37852-6.10752-7.13866.814-2.55116 1.37872-5.21171 1.74501-7.93184 5.50379.96738 12.26997 1.50702 19.67097 1.50705 18.22388-.00003 26.13007-4.22594 32.99648-7.77321-6.58894-3.33917-14.7726-7.8525-32.99648-7.85253-7.401 0-14.16718.59688-19.67097 1.58637-.36629-2.72013-.93101-5.38068-1.74501-7.93184 2.65675-1.76016 4.59867-4.2084 6.10752-7.13866.95254-1.55749 1.71836-3.3946 2.30024-5.39366l6.66275-3.80728c.19488 2.58651 4.28266 6.73014 10.07344 10.07344 6.75311 3.89884 11.1956 3.32066 14.67391 2.93478-1.44313-3.3765-3.08237-7.3643-9.83548-11.26322-4.09527-2.3644-8.11224-3.82442-10.94595-4.04524l9.28026-5.39365c.1961 2.58669 4.28353 6.81001 10.07344 10.15276 6.75309 3.89891 11.19561 3.24132 14.67392 2.85546-1.44312-3.37645-3.08236-7.36433-9.83549-11.26322-4.0954-2.36447-8.11216-3.82444-10.94595-4.04524l4.2832-2.45887c4.4797.46662 12.12113-1.88265 19.98825-6.42479 10.87617-6.27931 13.53931-12.64674 15.86369-18.08461-5.60194-.62143-12.76073-1.67894-23.6369 4.60047-7.88268 4.55103-13.72308 10.00326-15.54642 14.11868l-4.36251 2.53819c1.26402-2.55042 2.06228-6.68528 2.06228-11.50117-.00003-7.79778-2.63591-11.25992-4.83843-14.198-2.07324 2.81937-4.91772 6.3209-4.91774 14.11868 0 6.76243 1.70736 12.4182 3.8866 13.80141l-9.51821 5.47297c1.26404-2.55047 2.1416-6.7646 2.1416-11.58049.0001-7.79783-2.63586-11.1806-4.83843-14.11868-2.07329 2.81939-4.91767 6.24156-4.91774 14.03936-.00003 6.76456 1.70625 12.42051 3.8866 13.80141l-6.66275 3.88661c-2.06329-.51698-4.0113-.68169-5.86956-.63455-3.3182-.15976-6.41221.29956-9.28026 1.745-1.84029-2.02461-3.86153-3.87586-6.0282-5.55229 3.60636-4.28606 7.55472-9.83691 11.26322-16.26028 9.11192-15.78231 9.39506-24.72116 9.75617-32.44124-6.18628 4.03663-14.2077 8.88569-23.31963 24.66803-3.69225 6.3952-6.58328 12.5244-8.48707 17.76734-2.50794-1.02967-5.06933-1.8754-7.77321-2.45888-.19625-3.16966-1.31455-6.03929-3.09342-8.80434-.87253-1.60366-2.04974-3.17635-3.49001-4.67979v-7.69389c2.33749 1.12454 8.01063-.30535 13.80141-3.64865 6.75311-3.89894 8.4305-8.05797 9.83549-11.26322-3.64568-.4384-7.92081-1.04345-14.67392 2.85546-4.09532 2.36451-7.35491 5.11225-8.96298 7.45594v-10.70799c2.33818 1.12355 8.01152-.30585 13.80141-3.64865 6.75311-3.89892 8.4305-8.058 9.83549-11.26322-3.64568-.4384-7.92081-1.04345-14.67392 2.85546-4.09532 2.36448-7.35491 5.11225-8.96298 7.45594v-4.91775c2.64401-3.64621 4.44188-11.45929 4.44183-20.54348.00003-12.55873-4.22603-18.032491-7.77321-22.764391z"/></svg>'

  var flake1_res = scene.create({ t: "imageResource", url: flake1_svg, w: 200, h: 200});
  var flake2_res = scene.create({ t: "imageResource", url: flake2_svg, w: 200, h: 200});

  const spark_svg = "data:image/svg," + '<svg height="571" viewBox="0 0 575.806 571" width="575.806" xmlns="http://www.w3.org/2000/svg"><path d="m83.797 283.5-80.912-140.5 80.912-140.5h161.826l80.913 140.5-80.913 140.5z" fill="#e6e7e8" stroke="#5d6d65" stroke-width="5"/><path d="m101.463 252-63.262-109 63.262-109h126.495l63.262 109-63.262 109z" fill="#f16268" opacity=".75"/><path d="m223.755 41 59.044 102-59.044 102h-118.089l-59.044-102 59.044-102h118.414m8.081-15h-8.406-118.089-8.406l-4.21 7.454-59.045 102.116-4.226 7.346 4.226 7.323 59.044 102.256 4.211 7.505h8.406 118.089 8.406l4.21-7.493 59.044-102.137 4.226-7.355-4.226-7.328-59.043-102.219z" fill="#5d6d65"/><path d="m83.799 568.5-80.912-140.5 80.912-140.5h161.826l80.914 140.5-80.914 140.5z" fill="#e6e7e8" stroke="#5d6d65" stroke-width="5"/><path d="m101.465 533-63.262-109.499 63.262-109.501h126.496l63.262 109.501-63.262 109.499z" fill="#faef5f" opacity=".75"/><path d="m223.758 321 59.044 102.001-59.044 101.999h-118.09l-59.044-101.999 59.044-102.001h118.412m8.084-14h-8.406-118.09-8.406l-4.21 7.181-59.044 101.98-4.226 7.278 4.226 7.289 59.043 102.012 4.21 7.26h8.406 118.09 8.406l4.21-7.267 59.044-102.021 4.226-7.299-4.226-7.3-59.044-101.933z" fill="#5d6d65"/><path d="m330.181 425.5-80.913-140 80.913-140h161.824l80.913 140-80.913 140z" fill="#e6e7e8" stroke="#5d6d65" stroke-width="5"/><path d="m347.846 394-63.263-109.5 63.263-109.5h126.495l63.262 109.5-63.262 109.5z" fill="#f89958" opacity=".75"/><path d="m470.138 182 59.044 102-59.044 102h-118.089l-59.044-102 59.044-102h118.031m8.464-14h-8.406-118.089-8.406l-4.21 7.205-59.044 101.992-4.226 7.283 4.226 7.292 59.044 101.99 4.21 7.237h8.406 118.089 8.406l4.21-7.242 59.044-102.011 4.226-7.292-4.226-7.297-59.044-101.954z" fill="#5d6d65"/><path d="m285.83 428-22.434-39 22.434-39h44.867l22.434 39-22.434 39z" fill="#5d6d66"/><path d="m207.694 272.275 47.116-27.195 74.838 129.592-47.116 27.196z" fill="#5c6d65"/><path d="m97.708 312-15.824-27 15.824-27h31.646l15.824 27-15.824 27z" fill="#5d6d66"/><path d="m115.58 258.5h150v54h-150z" fill="#5c6d65"/><path d="m297.438 197-15.824-27 15.824-27h31.646l15.824 27-15.824 27z" fill="#5d6d66"/><path d="m254.324 325.59-47.116-27.195 74.838-129.593 47.116 27.196z" fill="#5c6d65"/></svg>';
  const spark_res = scene.create({ t: "imageResource", url: spark_svg, w: 200, h: 200});

// ###############################################
// ###############################################
var woffUrl = "https://fonts.gstatic.com/s/kaushanscript/v6/vm8vdRfvXFLG3OLnsO15WYS5DG74wNRVMJ8b.woff"
var woffRes = scene.create({ t: "fontResource", url: woffUrl});

woffRes.ready.then(function() {
  // console.log("here");
})
// ###############################################
// ###############################################

  var bg = scene.create({ t: 'rect', parent: root, fillColor: '#000', x: 0, y: 0, w: scene.w, h: scene.h, interactive: false }); 
  // var fontRes   = woffRes;//scene.create({ t: "fontResource", url: "FreeSans.ttf" });
  var container = scene.create({ t: "object", parent: bg,  x: 0, y: 0, w: 800, h: 600 });

  // --------------------------------------------------------------------------------------------------------------

  updateSize(scene.w, scene.h)

  // --------------------------------------------------------------------------------------------------------------

  function randInt(min,max)
  {
     return Math.floor(Math.random() * (max - min + 1));
  }

  // --------------------------------------------------------------------------------------------------------------

  function createFlake(res, x, y, w, h, t, flip)
  {
    //var flake_res = scene.create({ t: "imageResource", url: res, w: w, h: h});

    var flake = scene.create({ t:"image", parent: container, stretchX: scene.stretch.STRETCH, stretchY:scene.stretch.STRETCH,
                  resource: res, x: x, y: y, w: w, h: h, ry: 1, rz: flip, draw: false});

    flake.ready.then(function() 
    {
      flake.cx = flake.w / 2;
      flake.cy = flake.h / 2;

      flake.y = -h;

      flake.animateTo({r:-360}, t,scene.animation.TWEEN_LINEAR,scene.animation.OPTION_LOOP,scene.animation.COUNT_FOREVER);

      animateFlake(flake);

      flake.draw = true;
    });

    return flake;
  }

  function animateFlake(o)
  {
    var vv = randInt(3,8);

    o.animateTo({y: scene.h + o.h},vv, scene.animation.TWEEN_LINEAR,scene.animation.OPTION_LOOP, 1)//scene.animation.COUNT_FOREVER)
    .then(function(o)
    {
      o.x = randInt(0, scene.w - o.w);
      o.y = -scene.h;

      animateFlake(o);
    });
  }

  // --------------------------------------------------------------------------------------------------------------

  function createFlakes(w,h)
  {

    for(var n = 1; n < 100; n++)
    {
      var ww = randInt(12, 50);
      var hh = ww;

      var flip = randInt(0, 1);
      var res  = flip ? flake1_res : flake2_res;
      var xx   = randInt(0, w-ww);
      var yy   = -hh;
      var tt   = randInt(4,5);

      if( (n % 12) == 0)
      {
        res = spark_res;
      }

      flakes.push( createFlake(res, xx, yy, ww, hh, tt, flip) );
    }
  }

  // --------------------------------------------------------------------------------------------------------------

  function createBGscreen(w,h)
  {
    var screenBG    = scene.create({ t:"image", parent: container, url: base + "/images/bg.jpg",  draw: false });
    var screenBlack = scene.create({ t:"rect",  parent: screenBG,  w: w, h: h, fillColor: "#008", a: 0 });

    var msg = scene.create({ t: "text", parent: container, font: woffRes, interactive: false, pixelSize: 110, w: 400, h:100, px: 0.5, py: 0.5, text: "Happy Thanksgiving !", fillColor: "#fff", draw: false });

    return Promise.all([ screenBG.ready, msg.ready ])
                .catch( (err) =>
                {
                  console.log("SVG >> Creating Slide ... err = " + err);
                })
                .then( (success, failure) =>
                {
                  container.a = 0;

                  screenBG.draw = true;
                  msg.draw = true;

                  msg.x = (w/2);
                  msg.y = 130;

                  container.animateTo({a: 1.0 }, 1.5);
                });
  }

  // --------------------------------------------------------------------------------------------------------------

  function updateSize(w, h)
  {
    var ready = createBGscreen(w,h);

    ready.then( () =>
    {
      createFlakes(w,h);
    })

    container.w = w;
    container.h = h;
  }

  // --------------------------------------------------------------------------------------------------------------

  scene.on("onResize", function(e) {  updateSize(e.w,e.h); });
  scene.on("onClose",  function(e)  { });  // cleanup

  // --------------------------------------------------------------------------------------------------------------

}).catch(function importFailed(err){
   console.error("Import failed for pxTicker.js: " + err);
});